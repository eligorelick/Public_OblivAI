import{j as e,s,R as t,u as a,a as l}from"./index-CzFyAkSK.js";import{r,R as n,B as i,U as c,f as o,h as d,g as m,i as x,j as h,k as p,M as u,D as g,T as j,l as f,X as w,S as y,m as b}from"./ui-vendor-DlLrINX8.js";import"./webllm-B7Bnfzk1.js";import"./react-vendor-d2XN-_nt.js";import"./security-B43DZodL.js";const N=({messages:t,isGenerating:a=!1})=>{const l=r.useRef(null),[m,x]=n.useState(null);r.useEffect(()=>{var e;null==(e=l.current)||e.scrollIntoView({behavior:"smooth"})},[t]);const h=t=>{let a=s(t).replace(/```([\s\S]*?)```/g,'<pre class="bg-gray-800 rounded p-3 my-2 overflow-x-auto"><code>$1</code></pre>').replace(/`([^`]+)`/g,'<code class="bg-gray-800 px-1 py-0.5 rounded text-sm">$1</code>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\n/g,"<br />");const l=s(a);return e.jsx("div",{dangerouslySetInnerHTML:{__html:l},className:"prose prose-invert max-w-none"})};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-4 space-y-3 sm:space-y-4",role:"log","aria-live":"polite","aria-atomic":"false","aria-label":"Chat messages",children:[0===t.length&&e.jsxs("div",{className:"text-center text-gray-500 mt-8 px-4",children:[e.jsx(i,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Start a conversation with your private AI assistant"}),e.jsx("p",{className:"text-xs sm:text-sm mt-2",children:"Your messages never leave this device"})]}),t.map((s,t)=>e.jsxs("div",{className:`flex gap-2 sm:gap-3 ${"user"===s.role?"flex-row-reverse":"flex-row"} animate-fade-in`,role:"article","aria-label":"user"===s.role?"Your message":"AI response",children:[e.jsx("div",{className:"flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center "+("user"===s.role?"bg-primary":"glass"),children:"user"===s.role?e.jsx(c,{className:"h-3 w-3 sm:h-4 sm:w-4 text-white"}):e.jsx(i,{className:"h-3 w-3 sm:h-4 sm:w-4 text-accent"})}),e.jsxs("div",{className:"flex-1 max-w-[85%] sm:max-w-[70%] "+("user"===s.role?"text-right":"text-left"),children:[e.jsx("div",{className:"inline-block p-3 sm:p-4 rounded-2xl "+("user"===s.role?"bg-primary text-white":"glass text-gray-100"),children:"user"===s.role?e.jsx("p",{className:"whitespace-pre-wrap text-sm sm:text-base",children:s.content}):e.jsx("div",{className:"text-sm sm:text-base",children:h(s.content)})}),e.jsxs("div",{className:"mt-1 sm:mt-2 flex items-center gap-2 text-xs text-gray-500 "+("user"===s.role?"justify-end":"justify-start"),children:[e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("button",{onClick:()=>(async(e,s)=>{try{await navigator.clipboard.writeText(e),x(s),setTimeout(()=>x(null),2e3)}catch(t){}})(s.content,t),className:"hover:text-gray-300 transition-colors p-1","aria-label":"Copy message",children:m===t?e.jsx(o,{className:"h-3 w-3"}):e.jsx(d,{className:"h-3 w-3"})})]})]})]},t)),a&&e.jsxs("div",{className:"flex gap-2 sm:gap-3 animate-pulse","aria-live":"polite","aria-label":"AI is thinking",children:[e.jsx("div",{className:"flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center glass",children:e.jsx(i,{className:"h-3 w-3 sm:h-4 sm:w-4 text-accent"})}),e.jsx("div",{className:"flex-1 max-w-[85%] sm:max-w-[70%]",children:e.jsx("div",{className:"inline-block p-3 sm:p-4 rounded-2xl glass text-gray-100",children:e.jsx("span",{className:"text-sm sm:text-base",children:"Thinking..."})})})]}),e.jsx("div",{ref:l,"aria-hidden":"true"})]})},v=({onSendMessage:s,isGenerating:a,onStopGeneration:l,disabled:n=!1})=>{const[i,c]=r.useState(""),[o,d]=r.useState(!1),p=r.useRef(null),u=r.useRef(new t(10,6e4));r.useEffect(()=>{p.current&&(p.current.style.height="auto",p.current.style.height=`${Math.min(p.current.scrollHeight,200)}px`)},[i]);const g=e=>{if(e.preventDefault(),i.trim()&&!n&&!a){if(!u.current.canProceed())return d(!0),void setTimeout(()=>d(!1),3e3);s(i.trim()),c("")}};return e.jsxs("div",{className:"border-t border-white/10 p-3 sm:p-4",children:[o&&e.jsx("div",{className:"mb-3 glass rounded-lg p-3 border-yellow-500/50 bg-yellow-500/10",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-yellow-400",children:[e.jsx(m,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"Please slow down. Too many messages sent."})]})}),e.jsxs("form",{onSubmit:g,className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:p,value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey?"Enter"===e.key&&e.ctrlKey?(e.preventDefault(),g(e)):"Escape"===e.key&&a&&(e.preventDefault(),l()):(e.preventDefault(),g(e))},placeholder:n?"Please select a model first...":"Type your message... (Enter to send, Shift+Enter for new line, Escape to stop)","aria-label":"Message input","aria-describedby":"input-help",disabled:n||a,className:"w-full glass rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base text-white placeholder-gray-500\n                     focus:outline-none focus:ring-2 focus:ring-primary resize-none\n                     disabled:opacity-50 disabled:cursor-not-allowed min-h-[2.5rem]",rows:1,maxLength:4e3}),e.jsxs("div",{className:"absolute bottom-1 right-2 text-xs text-gray-500",children:[i.length,"/4000"]})]}),a?e.jsxs("button",{type:"button",onClick:l,className:"glass px-3 sm:px-6 py-2 sm:py-3 rounded-xl text-white hover:bg-red-500/20\n                     transition-colors flex items-center gap-1 sm:gap-2 flex-shrink-0","aria-label":"Stop generation",children:[e.jsx(x,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Stop"})]}):e.jsxs("button",{type:"submit",disabled:!i.trim()||n,className:"gradient-primary px-3 sm:px-6 py-2 sm:py-3 rounded-xl text-white\n                     disabled:opacity-50 disabled:cursor-not-allowed\n                     hover:opacity-90 transition-opacity flex items-center gap-1 sm:gap-2 flex-shrink-0","aria-label":"Send message",children:[e.jsx(h,{className:"h-4 w-4 sm:h-5 sm:w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Send"})]})]}),e.jsxs("div",{id:"input-help",className:"mt-2 text-xs text-gray-500 text-center px-2",children:["All messages are processed locally â€¢ No data leaves your device",e.jsx("span",{className:"hidden sm:inline",children:" â€¢ Shortcuts: Enter (send), Ctrl+Enter (send), Escape (stop)"})]})]})},k=({onBack:s})=>{const{messages:t,selectedModel:l,isDarkMode:r,autoDeleteChats:i,clearAllHistory:c,toggleDarkMode:o,setAutoDeleteChats:d,exportChat:m,contextTokenCount:x}=a(),[h,b]=n.useState(!1),[N,v]=n.useState(!1),k=a(e=>e.systemInstruction),C=a(e=>e.setSystemInstruction),[S,T]=n.useState(k||""),[E,D]=n.useState(!1),[M,I]=n.useState(!1);return n.useEffect(()=>{T(k||"")},[k]),e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"glass border-b border-white/10",children:e.jsx("div",{className:"max-w-6xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[s&&e.jsx("button",{onClick:s,className:"glass p-2 rounded-lg glass-hover mr-2",children:"â†"}),e.jsx("div",{className:"h-6 w-6 sm:h-8 sm:w-8 bg-gradient-to-br from-primary to-accent rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("img",{src:"/Whitelogotransparentbg.png",alt:"OBLIVAI",className:"w-4 h-4 sm:w-6 sm:h-6 object-contain"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-white",children:"OBLIVAI"}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[l?l.name:"No model selected"," â€¢"," ",e.jsxs("span",{className:"hidden sm:inline",children:[t.length," msgs â€¢ "]}),x>0&&e.jsxs("span",{className:x>3072?"text-red-400":x>2048?"text-yellow-400":"text-gray-400",children:[x," tokens â€¢"," "]}),"100% Private"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:o,className:"glass p-2 rounded-lg glass-hover","aria-label":"Toggle theme",children:r?e.jsx(p,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300"}):e.jsx(u,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300"})}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const e=m(),s=new Blob([e],{type:"text/markdown"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`oblivai-chat-${(new Date).toISOString().split("T")[0]}.md`,a.click(),URL.revokeObjectURL(t)},className:"glass p-2 rounded-lg glass-hover","aria-label":"Export chat",children:e.jsx(g,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300"})}),e.jsx("button",{onClick:()=>{v(!0)},className:"glass p-2 rounded-lg glass-hover","aria-label":"Clear chat",children:e.jsx(j,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300"})})]}),e.jsx("button",{onClick:()=>b(!h),className:"glass p-2 rounded-lg glass-hover","aria-label":"Settings",children:e.jsx(f,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-300"})})]})]})})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Privacy Settings"}),e.jsx("button",{onClick:()=>b(!1),className:"glass p-2 rounded-lg glass-hover",children:e.jsx(w,{className:"h-4 w-4 text-gray-300"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white font-medium mb-2",children:"Assistant Instructions"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[[{id:"concise",label:"Concise",text:"Answer succinctly and directly. Keep responses short and to the point."},{id:"detailed",label:"Detailed",text:"Provide thorough and detailed answers. Explain reasoning and include examples when helpful."},{id:"clarify",label:"Ask for clarification",text:"When the user query is ambiguous, ask clarifying questions before answering."}].map(s=>e.jsx("button",{onClick:()=>T(s.text),className:"glass px-2 py-1 rounded-md text-sm text-white",children:s.label},s.id)),e.jsxs("div",{className:"ml-auto relative",children:[e.jsx("button",{onClick:()=>D(!E),className:"glass px-2 py-1 rounded-md text-sm text-white",children:"Examples"}),E&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 glass rounded-md p-3 z-50",children:[e.jsx("p",{className:"text-xs text-gray-300 mb-2",children:"Try these examples:"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>T("You are an expert assistant. Provide concise and accurate answers."),className:"text-left w-full",children:"Expert concise helper"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>T("You are an assistant that always asks clarifying questions when intent is unclear."),className:"text-left w-full",children:"Clarify intent"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>T("Always provide step-by-step instructions when explaining how to perform tasks."),className:"text-left w-full",children:"Step-by-step instructions"})})]})]})]})]}),e.jsx("textarea",{value:S,onChange:e=>T(e.target.value),className:"w-full glass rounded-md p-3 text-sm text-white placeholder-gray-500 h-28",placeholder:"Give initial directions to the assistant, e.g. 'Answer all user questions succinctly and ask clarifying questions when needed.'"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>{C(S||""),I(!0),setTimeout(()=>I(!1),2e3)},className:"glass px-3 py-2 rounded-md text-white hover:bg-primary/20 transition-colors",children:M?"âœ“ Saved!":"Save Instructions"}),e.jsx("button",{onClick:()=>{T(""),C(""),I(!1)},className:"glass px-3 py-2 rounded-md text-white hover:bg-red-500/20 transition-colors",children:"Clear"})]}),k&&!M&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs text-green-400",children:"âœ“ Instructions active: Will apply to new messages"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Note: Larger models (3B+) follow instructions better than smaller ones"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-5 w-5 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Auto-delete chats"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Clear chat history on session end"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:e=>d(e.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:ring-2 peer-focus:ring-primary rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-5 w-5 text-accent"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Storage disabled (privacy)"}),e.jsx("p",{className:"text-xs text-gray-400",children:"This build enforces in-memory only operation; no localStorage, Cache, or IndexedDB writes occur."})]})]})}),e.jsxs("div",{className:"glass rounded-lg p-4 border-green-500/30 bg-green-500/10",children:[e.jsx("p",{className:"text-sm text-green-400",children:"âœ“ All data stays in your browser"}),e.jsx("p",{className:"text-sm text-green-400 mt-1",children:"âœ“ No server connections"}),e.jsx("p",{className:"text-sm text-green-400 mt-1",children:"âœ“ No tracking or analytics"})]})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Clear all messages?"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"This will permanently delete all messages in the current chat. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 glass px-4 py-2 rounded-lg glass-hover text-white",children:"Cancel"}),e.jsx("button",{onClick:()=>{c(),v(!1)},className:"flex-1 bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600 text-white",children:"Clear"})]})]})})]})},C=({webllmService:s,onBack:t})=>{const{messages:n,isGenerating:i,addMessage:c,setGenerating:o,selectedModel:d,clearMessages:x,contextTokenCount:h,showContextWarning:p,dismissContextWarning:u,systemInstruction:g}=a(),[j,f]=r.useState(!0);r.useEffect(()=>{const e=setTimeout(()=>{const e=document.querySelector('textarea[aria-label="Message input"]');e&&e.focus()},100);return()=>clearTimeout(e)},[]);const y=p&&j,C=Math.min(100,Math.round(h/4096*100)),S=h>3072;return e.jsxs("div",{id:"main-content",className:"flex flex-col h-screen bg-dark",role:"main","aria-label":"Chat interface",children:[e.jsx(k,{onBack:t}),y&&e.jsx("div",{className:(S?"bg-red-500/10 border-red-500/30":"bg-yellow-500/10 border-yellow-500/30")+" border-b px-4 py-3",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-start gap-3",children:[e.jsx(m,{className:`h-5 w-5 ${S?"text-red-400":"text-yellow-400"} flex-shrink-0 mt-0.5`}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsxs("p",{className:(S?"text-red-200":"text-yellow-200")+" font-medium mb-1",children:[S?"ðŸ”´ Critical: Context too long!":"âš ï¸ Long conversation detected",e.jsxs("span",{className:"ml-2 text-xs opacity-80",children:["(~",h.toLocaleString()," tokens, ",C,"% of limit)"]})]}),e.jsx("p",{className:(S?"text-red-300/80":"text-yellow-300/80")+" text-xs",children:S?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Consumer GPUs struggle with long context."})," Responses may be slow, degraded, or cause crashes.",e.jsx("button",{onClick:()=>{x(),f(!1)},className:`ml-1 underline ${S?"hover:text-red-200":"hover:text-yellow-200"} font-semibold`,children:"Clear chat now"})," (recommended)"]}):e.jsxs(e.Fragment,{children:["Large context uses more VRAM and may slow down responses on consumer GPUs (RTX 4050/3060/etc).",e.jsx("button",{onClick:()=>{x(),f(!1)},className:"ml-1 underline hover:text-yellow-200 font-medium",children:"Clear chat"})," to improve performance, or continue if your GPU can handle it."]})})]}),e.jsx("button",{onClick:()=>{u(),f(!1)},className:(S?"text-red-400/60 hover:text-red-400":"text-yellow-400/60 hover:text-yellow-400")+" transition-colors","aria-label":"Dismiss warning",children:e.jsx(w,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col max-w-6xl mx-auto w-full px-2 sm:px-4",children:[e.jsx(N,{messages:n,isGenerating:i}),g&&g.trim()&&e.jsx("div",{className:"px-2 py-1.5 bg-purple-500/10 border-t border-purple-500/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-300",children:[e.jsx(b,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{className:"truncate",children:['Custom instructions active: "',g.slice(0,50),g.length>50?"...":"",'"']})]})}),e.jsx(v,{onSendMessage:async e=>{if(!d||!s.isModelLoaded())return;const t={role:"user",content:l(e).slice(0,4e3),timestamp:new Date};c(t),o(!0);try{const e=h>2048?6:10,l=[...n.slice(-e),t];let r="";const i={role:"assistant",content:"",timestamp:new Date};c(i),await s.generateResponse(l,e=>{r+=e,a.setState(e=>({messages:[...e.messages.slice(0,-1),{...i,content:r}]}))},void 0,g)}catch(r){c({role:"assistant",content:`Error: ${r instanceof Error?r.message:"Failed to generate response"}`,timestamp:new Date})}finally{o(!1)}},isGenerating:i,onStopGeneration:()=>{s.cancelGeneration(),o(!1)},disabled:!d||!s.isModelLoaded()})]})]})};export{C as ChatInterface};
